---
layout: single
title:  "Receiving artifacts from GitHub"
sidebar:
  nav: guides
---

{% include toc %}

> This guide assumes that you have enabled the `artifactsRewrite` feature flag.
> See [Prerequisite configuration/setup](#prerequisite-configurationsetup).

This guide explains how to configure Spinnaker to trigger pipelines based on
commits to a [GitHub](https://github.com) repository and inject changed GitHub
files as [artifacts](/reference/artifacts) into a pipeline.

This functionality uses GitHub
[Webhooks](https://developer.github.com/webhooks/) for delivering messages to
Spinnaker, and must be configured to send messages to Spinnaker's event bus as
shown below.

# Prerequisite configuration/setup

If you (or your Spinnaker admin) have already configured Spinnaker to listen to
a GitHub webhooks from the repository you plan to publish commits to, you can
skip this section.

You need the following:

* A GitHub repository either under your user, or in an organization or user's
  account that you have permission to publish commits to.

  This will be referred to as `$ORGANIZATION/$REPOSITORY` from now on (for
  example, `spinnaker/clouddriver`).

* [A running Spinnaker instance](/setup/install/). This guide shows you how to
  update it to accept messages from GitHub.

* The `artifactsRewrite` feature flag enabled in Spinnaker. In
  `~/.hal/$DEPLOYMENT/profiles/settings-local.js` (where `$DEPLOYMENT` is
  typically `default`), add the line
  `window.spinnakerSettings.feature.artifactsRewrite = true;`.


At this point, we will configure GitHub webhooks and a GitHub artifact account.
The webhook will be received by Spinnaker whenever a commit is made, and the
artifact account will allow you to download any pertinent files.

## 1. Configure GitHub webhooks

Follow the [GitHub webhook configuration](/setup/triggers/github/).

## 2. Configure a GitHub artifact account

Follow the [GitHub artifact configuration](/setup/artifacts/github/).

## 3. Apply your configuration changes

Once the artifact changes have been made using Halyard, run

```bash
hal deploy apply
```

to apply them in Spinnaker.

# Using GitHub artifacts in pipelines

We will need either an existing or a new pipeline that we want to be triggered
on changes to GitHub artifacts. If you do not have a pipeline, create one as shown
below.

{%
  include
  figure
  image_path="./create-pipeline.png"
  caption="You can create and edit pipelines in the __Pipelines__ tab of
  Spinnaker"
%}

## Configure the GitHub trigger

Let's add a Git trigger to run our pipeline. To configure the trigger:

| Field | Value |
|-------|-------|
| __Type__ | "Git" | 
| __Repo Type__ | "GitHub" |
| __Organization or User__  | `$ORGANIZATION` from above |
| __Project__ | `$REPOSITORY` from above |
| __Branch__ | (optional) Can be used (via regular expressions) to describe which branches to listen to changes one |
| __Secret__ | (optional) _Strongly encouraged_ It must match the secret provided to the [webhook configuration](/setup/triggers/github/#configuring-your-github-webhook) |

{%
  include
  figure
  image_path="./git-config.png"
%}

## Configure the GitHub artifact

Now we need to declare that the GitHub trigger expects that a specific artifact
matching some criteria is available before the pipeline starts executing. In
doing so, you guarantee that an artifact matching your description is present in
the pipeline's execution context. If no artifact for this description is present,
the pipeline won't start.

To configure the artifact, go to the __Artifact Constraints__ dropdown for the
GitHub trigger configuration, and select __"Define a new artifact..."__ to bring
up the __Expected Artifact__ form.

{%
  include
  figure
  image_path="./expected-artifact.png"
%}

Enter the artifact information:

1. Enter a __Display Name__, or leave the autogenerated default.

1. In the __Account__ dropdown, select your GitHub account.

1. Enter a value in the __File path__ field.

	 > __â˜ž Note__: This path can be a regular expression. You can, for example,
	 > set the object path to be `folder/.*\.yml` to trigger on any change to a
	 > YAML file inside `folder` in your repository.

## Test the pipeline

If you add or modify a file matching your expected artifact to the configured
repository, it should execute. If it doesn't, you can start by checking the
logs of the __Echo__ service.
